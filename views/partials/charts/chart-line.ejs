<script type="text/javascript">
    // store all charts
    var charts = {};

    // shows the chart as selected
    function selectChartData(button, elementId, text) {
        if (button) {
            var parent = button.parentElement;
            Array.from(parent.children).forEach(node => {
                node.classList.remove('active');
            });
            button.classList.add('active');
        }

        var canvas = document.getElementById(elementId);
        var chart = charts[elementId];
        const chdata = JSON.parse(canvas.getAttribute('data-chart-line'));
        const dataLength = {
            '1W': 5,
            '2W': 10,
            '1M': 21,   //30*5/7,
            '3M': 64,   //90*5/7,
            '6M': 128,  //180*5/7,
            '1Y': 260,  //365*5/7,
            '2Y': 521,  //365*2*5/7,
            '5Y': 1303, //365*5*5/7,
            'All': chdata.length,
        };
        var result = [];

        // restrict graph to show no more than x values
        const max = 160;
        if (dataLength[text] > max) {
            const interval = Math.ceil(dataLength[text]/max);
            for(var i = 0; i < dataLength[text]; i += interval) {
                result.push(chdata[i]);
            }
        }
        else {
            result = chdata.slice(0, dataLength[text]);
        }

        chart.data.datasets[0].data = result;
        chart.update();
    }

    var canvases = document.querySelectorAll('[data-chart-line]');
    canvases.forEach(canvas => {
        var ctx = canvas.getContext('2d');
        var chart = new Chart(ctx, {
            type: 'line',
            data: {
                // labels,
                datasets: [{
                    data: [],
                    backgroundColor: ['rgba(54, 162, 235, 0.4)'],
                    borderColor: ['rgba(54, 162, 235, 1)'],
                    fill: false,
                    borderWidth: 2,
                    pointRadius: 0,
                }],
            },
            options: {
                animation: {
                    duration: 0,
                },
                aspectRatio: 1,
                title: { display: false },
                legend: { display: false },
                scales: {
                    xAxes: [{
                        type: 'time',
                        distribution: 'linear',
                        display: false, 
                        offset: true,
                        gridLines: {
                            display: false,
                        },
                    }],
                    yAxes: [{
                        display: false,
                        offset: true,
                    }],
                },
                tooltips: {
                    // enabled: true,
                    intersect: false,
                    mode: 'nearest',
                },
            },
        })
        
        // save the chart in the element
        charts[canvas.id] = chart;

        // select the data
        selectChartData(null, canvas.id, '1M');
    });
</script>