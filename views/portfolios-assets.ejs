<%- include("./partials/header"); -%>

<div class="mini-nav">
    <ul>
        <li><a href="/portfolios">Back to Overview</a></li>
        <li><a href="/portfolios/<%= portfolio._id %>"><%- portfolio.portfolio %></a></li>
        <li><a href="/portfolios/<%= portfolio._id %>/create" class="btn">Add Asset</a></li>
    </ul>
</div>
<div class="assets-list">
    <% if (assets === undefined) { %>
    
        <div class="error">An error occurred!</div>

    <% } else if (assets.length == 0) { %>

        <div class="error">There are no assets!</div>

    <% } else { %>
        <table>
            <tr>
                <th>Type</th>
                <th>Name</th>
                <th>Last Price</th>
                <th>Change</th>
                <th>Value / Cost</th>
                <th>Daily</th>
            </tr>
            <% assets.forEach((asset) => { %>
                <tr>
                    <td rowspan="2"><%- asset.kind %></td>
                    <td><a href="/portfolios/<%= portfolio._id %>/<%= asset.ticker %>"><%- asset.ticker %></a></td>
                    <td><%- asset.exchangeIntraday.Open %></td>
                    <td><%- asset.change_value %></td>
                    <td><%- asset.unrealized_value %></td>
                    <td><%- asset.daily_value %></td>
                    <td rowspan="2">DEL</td>
                </tr>
                <tr>
                    <td><a href="/portfolios/<%= portfolio._id %>/<%=asset._id %>"><%- asset.exchangeOverview.Name %></a></td>          
                    <td><%- asset.exchangeIntraday.LastRefreshed %></td>
                    <td><%- asset.change_value_percentage %>%</td>                    
                    <td><%- asset.unrealized_value_percentage %>%</td>                    
                    <td><%- asset.daily_value_percentage %>%</td>                    
                </tr>
            <% }); %>
        </table>
    <% } %>
</div>

<%- include("./partials/footer"); -%>

<!-- <td rowspan="2">
    <a class="delete" data-doc="<%= portfolio._id %>">
        <img src="/img/trashcan.svg" alt="delete icon">
    </a>
</td>
<script>
    const trashcan = document.querySelector('a.delete');

    trashcan.addEventListener('click', (e) => {
        const endpoint = `/blogs/${trashcan.dataset.doc}`;
        fetch(endpoint, {
            method: 'DELETE',
        })
        .then(response => response.json())
        .then(data => window.location.href = data.redirect)
        .catch(err => console.log(err));
    });
</script> -->